<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext">
<link rel="stylesheet" href="../lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="../js/jquery.fancybox.min.css">
  <link rel="stylesheet" href="../js/pace-theme-minimal.min.css">
  <script src="../js/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.xuemingde.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":true,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":10,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="easypoi导入Excel表格报错">
<meta property="og:url" content="https://blog.xuemingde.com/posts/HAXCJE.html">
<meta property="og:site_name" content="WiseWanderer">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xuemingde.com/pages/image/2022/03/08/OfMAOd.png">
<meta property="article:published_time" content="2024-07-18T05:30:51.737Z">
<meta property="article:modified_time" content="2024-07-18T05:30:51.738Z">
<meta property="article:author" content="meadee">
<meta property="article:tag" content="C">
<meta property="article:tag" content="sql">
<meta property="article:tag" content="cache">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xuemingde.com/pages/image/2022/03/08/OfMAOd.png">

<link rel="canonical" href="https://blog.xuemingde.com/posts/HAXCJE.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>easypoi导入Excel表格报错 | WiseWanderer</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">WiseWanderer</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">每个人都有反叛心理，越是强制越是反抗</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">181</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">36</span></a>

  </li>
        <li class="menu-item menu-item-bookmark">

    <a href="/bookmark/" rel="section"><i class="fa fa-bookmark fa-fw"></i>书签</a>

  </li>
        <li class="menu-item menu-item-collect">

    <a href="/collect/" rel="section"><i class="fa fa-star fa-fw"></i>收藏</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

           <div id="container-1">
            <div class="content post posts-expand">
            

    
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.xuemingde.com/posts/HAXCJE.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpeg">
      <meta itemprop="name" content="meadee">
      <meta itemprop="description" content="沉默，有时候是一种无声的反抗">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WiseWanderer">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          easypoi导入Excel表格报错
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-07-18 13:30:51" itemprop="dateCreated datePublished" datetime="2024-07-18T13:30:51+08:00">2024-07-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/java/BUG/" itemprop="url" rel="index"><span itemprop="name">BUG</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>34k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 ≈</span>
              <span>31 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style><p>错误信息</p>
<figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Handler dispatch failed; nested exception is java.lang.NoSuchMethodError: org.apache.poi.ss.usermodel.Cell.getCellType()Lorg<span class="regexp">/apache/</span>poi<span class="regexp">/ss/u</span>sermodel/CellType;</span><br></pre></td></tr></tbody></table></figure>
<p>查看源码，发现这个地方报错</p>
<p><img data-src="https://xuemingde.com/pages/image/2022/03/08/OfMAOd.png" alt=""></p>
<p>poi版本导致（3.17），到时从easypoi中去除poi，重新引用新版本的poi（5.0.0），还是会加载出3.17版本的，未找到原因，最后的解决方法是，重写了easypoi的Excel导入功能。</p>
<p>重写代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelUtils</span> </span>{</span><br><span class="line"></span><br><span class="line">  	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  重写了 easypoi导入，因为easypoi的导入报错</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> inputstream</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pojoClass</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">importExcelRewrite</span><span class="params">(InputStream inputstream, Class&lt;?&gt; pojoClass, ImportParams params)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ExcelImportServiceImok().importExcelByIss(inputstream, pojoClass, params, <span class="keyword">false</span>).getList();</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.entity.BaseTypeConstants;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.annotation.ExcelTarget;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.ImportParams;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.params.ExcelCollectionParams;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.params.ExcelImportEntity;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.result.ExcelImportResult;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.entity.result.ExcelVerifyHandlerResult;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.imports.ExcelImportService;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.excel.imports.recursive.ExcelImportForkJoinWork;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.exception.excel.ExcelImportException;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.exception.excel.enums.ExcelImportEnum;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.handler.inter.IExcelDataHandler;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.handler.inter.IExcelDataModel;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.handler.inter.IExcelDictHandler;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.handler.inter.IExcelModel;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.util.PoiPublicUtil;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.util.PoiReflectorUtil;</span><br><span class="line"><span class="keyword">import</span> cn.afterturn.easypoi.util.PoiValidationUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.builder.ReflectionToStringBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.time.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFSheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.HSSFWorkbook;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.formula.functions.T;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.util.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.sql.Time;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.time.ZoneId;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> X-MD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 重写表格导入</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createTime</span> 2022年03月08日 14:56:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelImportServiceImok</span> <span class="keyword">extends</span> <span class="title">ExcelImportService</span> </span>{</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExcelImportServiceImok.class);</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; handlerList = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> verifyFail = <span class="keyword">false</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 异常数据styler</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CellStyle errorCellStyle;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> List&lt;Row&gt; successRow;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Row&gt; failRow;</span><br><span class="line">	<span class="keyword">private</span> List failCollection;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ExcelImportServiceImok</span><span class="params">()</span> </span>{</span><br><span class="line">		successRow = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		failRow = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		failCollection = <span class="keyword">new</span> ArrayList();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * 向List里面继续添加元素</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> row</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> titlemap</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> targetId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pictures</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addListContinues</span><span class="params">(Object object, ExcelCollectionParams param, Row row,</span></span></span><br><span class="line"><span class="function"><span class="params">								 Map&lt;Integer, String&gt; titlemap, String targetId,</span></span></span><br><span class="line"><span class="function"><span class="params">								 Map&lt;String, PictureData&gt; pictures,</span></span></span><br><span class="line"><span class="function"><span class="params">								 ImportParams params, StringBuilder errorMsg)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		Collection collection = (Collection) PoiReflectorUtil.fromCache(object.getClass())</span><br><span class="line">				.getValue(object, param.getName());</span><br><span class="line">		Object entity = PoiPublicUtil.createObject(param.getType(), targetId);</span><br><span class="line">		<span class="keyword">if</span> (entity <span class="keyword">instanceof</span> IExcelDataModel) {</span><br><span class="line">			((IExcelDataModel) entity).setRowNum(row.getRowNum());</span><br><span class="line">		}</span><br><span class="line">		String picId;</span><br><span class="line">		<span class="comment">// 是否需要加上这个对象</span></span><br><span class="line">		<span class="keyword">boolean</span> isUsed = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = row.getFirstCellNum(); i &lt; titlemap.size(); i++) {</span><br><span class="line">			Cell cell = row.getCell(i);</span><br><span class="line">			String titleString = titlemap.get(i);</span><br><span class="line">			<span class="keyword">if</span> (param.getExcelParams().containsKey(titleString)) {</span><br><span class="line">				<span class="keyword">if</span> (param.getExcelParams().get(titleString).getType() == BaseTypeConstants.IMAGE_TYPE) {</span><br><span class="line">					picId = row.getRowNum() + <span class="string">"_"</span> + i;</span><br><span class="line">					saveImage(entity, picId, param.getExcelParams(), titleString, pictures, params);</span><br><span class="line">				} <span class="keyword">else</span> {</span><br><span class="line">					<span class="keyword">try</span> {</span><br><span class="line">						saveFieldValues(params, entity, cell, param.getExcelParams(), titleString, row);</span><br><span class="line">					} <span class="keyword">catch</span> (ExcelImportException e) {</span><br><span class="line">						<span class="comment">// 如果需要去校验就忽略,这个错误,继续执行</span></span><br><span class="line">						<span class="keyword">if</span> (params.isNeedVerify() &amp;&amp; ExcelImportEnum.GET_VALUE_ERROR.equals(e.getType())) {</span><br><span class="line">							errorMsg.append(<span class="string">" "</span>).append(titleString).append(ExcelImportEnum.GET_VALUE_ERROR.getMsg());</span><br><span class="line">						}</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">				isUsed = <span class="keyword">true</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (isUsed) {</span><br><span class="line">			collection.add(entity);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取key的值,针对不同类型获取不同的值</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> JueYue 2013-11-21</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">getKeyValue</span><span class="params">(Cell cell)</span> </span>{</span><br><span class="line">		Object obj = PoiCellUtils.getCellValue(cell);</span><br><span class="line">		<span class="keyword">return</span> obj == <span class="keyword">null</span> ? <span class="keyword">null</span> : obj.toString().trim();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取保存的真实路径</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">getSaveUrl</span><span class="params">(ExcelImportEntity excelImportEntity, Object object)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		<span class="keyword">if</span> (ExcelImportEntity.IMG_SAVE_PATH.equals(excelImportEntity.getSaveUrl())) {</span><br><span class="line">			<span class="keyword">if</span> (excelImportEntity.getMethods() != <span class="keyword">null</span></span><br><span class="line">					&amp;&amp; excelImportEntity.getMethods().size() &gt; <span class="number">0</span>) {</span><br><span class="line">				object = getFieldBySomeMethod(excelImportEntity.getMethods(), object);</span><br><span class="line">			}</span><br><span class="line">			String url = object.getClass().getName()</span><br><span class="line">					.split(<span class="string">"\\."</span>)[object.getClass().getName().split(<span class="string">"\\."</span>).length - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">return</span> excelImportEntity.getSaveUrl() + File.separator + url;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> excelImportEntity.getSaveUrl();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">importExcel</span><span class="params">(Collection&lt;T&gt; result, Sheet sheet, Class&lt;?&gt; pojoClass,</span></span></span><br><span class="line"><span class="function"><span class="params">									ImportParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">									Map&lt;String, PictureData&gt; pictures)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		List collection = <span class="keyword">new</span> ArrayList();</span><br><span class="line">		Map&lt;String, ExcelImportEntity&gt; excelParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		List&lt;ExcelCollectionParams&gt; excelCollection = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		String targetId = <span class="keyword">null</span>;</span><br><span class="line">		i18nHandler = params.getI18nHandler();</span><br><span class="line">		<span class="keyword">boolean</span> isMap = Map.class.equals(pojoClass);</span><br><span class="line">		<span class="keyword">if</span> (!isMap) {</span><br><span class="line">			Field[] fileds = PoiPublicUtil.getClassFields(pojoClass);</span><br><span class="line">			ExcelTarget etarget = pojoClass.getAnnotation(ExcelTarget.class);</span><br><span class="line">			<span class="keyword">if</span> (etarget != <span class="keyword">null</span>) {</span><br><span class="line">				targetId = etarget.value();</span><br><span class="line">			}</span><br><span class="line">			getAllExcelField(targetId, fileds, excelParams, excelCollection, pojoClass, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">		}</span><br><span class="line">		Iterator&lt;Row&gt; rows = sheet.rowIterator();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; params.getTitleRows(); j++) {</span><br><span class="line">			rows.next();</span><br><span class="line">		}</span><br><span class="line">		Map&lt;Integer, String&gt; titlemap = getTitleMap(rows, params, excelCollection, excelParams);</span><br><span class="line">		checkIsValidTemplate(titlemap, excelParams, params, excelCollection);</span><br><span class="line">		Object object = <span class="keyword">null</span>;</span><br><span class="line">		String picId;</span><br><span class="line">		<span class="keyword">int</span> readRow = <span class="number">1</span>;</span><br><span class="line">		<span class="comment">//跳过无效行</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.getStartRows(); i++) {</span><br><span class="line">			rows.next();</span><br><span class="line">		}</span><br><span class="line">		<span class="comment">//判断index 和集合,集合情况默认为第一列</span></span><br><span class="line">		<span class="keyword">if</span> (excelCollection.size() &gt; <span class="number">0</span> &amp;&amp; params.getKeyIndex() == <span class="keyword">null</span>) {</span><br><span class="line">			params.setKeyIndex(<span class="number">0</span>);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">int</span> endRow = sheet.getLastRowNum() - params.getLastOfInvalidRow();</span><br><span class="line">		<span class="keyword">if</span> (params.getReadRows() &gt; <span class="number">0</span>) {</span><br><span class="line">			endRow = Math.min(params.getReadRows(), endRow);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (params.isConcurrentTask()) {</span><br><span class="line">			ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">			ExcelImportForkJoinWork task = <span class="keyword">new</span> ExcelImportForkJoinWork(params.getStartRows() + params.getHeadRows() + params.getTitleRows(), endRow, sheet, params, pojoClass, <span class="keyword">this</span>, targetId, titlemap, excelParams);</span><br><span class="line">			ExcelImportResult forkJoinResult = forkJoinPool.invoke(task);</span><br><span class="line">			collection = forkJoinResult.getList();</span><br><span class="line">			failCollection = forkJoinResult.getFailList();</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			StringBuilder errorMsg;</span><br><span class="line">			<span class="keyword">while</span> (rows.hasNext()) {</span><br><span class="line">				Row row = rows.next();</span><br><span class="line">				<span class="comment">// Fix 如果row为无效行时候跳出</span></span><br><span class="line">				<span class="keyword">if</span> (row.getRowNum() &gt; endRow) {</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				}</span><br><span class="line">				<span class="comment">/* 如果当前行的单元格都是无效的，那就继续下一行 */</span></span><br><span class="line">				<span class="keyword">if</span> (row.getLastCellNum() &lt; <span class="number">0</span>) {</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				}</span><br><span class="line">				<span class="keyword">if</span> (isMap &amp;&amp; object != <span class="keyword">null</span>) {</span><br><span class="line">					((Map) object).put(<span class="string">"excelRowNum"</span>, row.getRowNum());</span><br><span class="line">				}</span><br><span class="line">				errorMsg = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">				<span class="comment">// 判断是集合元素还是不是集合元素,如果是就继续加入这个集合,不是就创建新的对象</span></span><br><span class="line">				<span class="comment">// keyIndex 如果为空就不处理,仍然处理这一行</span></span><br><span class="line">				<span class="keyword">if</span> (params.getKeyIndex() != <span class="keyword">null</span></span><br><span class="line">						&amp;&amp; (row.getCell(params.getKeyIndex()) == <span class="keyword">null</span></span><br><span class="line">						|| StringUtils.isEmpty(getKeyValue(row.getCell(params.getKeyIndex()))))</span><br><span class="line">						&amp;&amp; object != <span class="keyword">null</span>) {</span><br><span class="line">					<span class="keyword">for</span> (ExcelCollectionParams param : excelCollection) {</span><br><span class="line">						addListContinues(object, param, row, titlemap, targetId, pictures, params, errorMsg);</span><br><span class="line">					}</span><br><span class="line">				} <span class="keyword">else</span> {</span><br><span class="line">					object = PoiPublicUtil.createObject(pojoClass, targetId);</span><br><span class="line">					<span class="keyword">try</span> {</span><br><span class="line">						Set&lt;Integer&gt; keys = titlemap.keySet();</span><br><span class="line">						<span class="keyword">for</span> (Integer cn : keys) {</span><br><span class="line">							Cell cell = row.getCell(cn);</span><br><span class="line">							String titleString = titlemap.get(cn);</span><br><span class="line">							<span class="keyword">if</span> (excelParams.containsKey(titleString) || isMap) {</span><br><span class="line">								<span class="keyword">if</span> (excelParams.get(titleString) != <span class="keyword">null</span></span><br><span class="line">										&amp;&amp; excelParams.get(titleString).getType() == BaseTypeConstants.IMAGE_TYPE) {</span><br><span class="line">									picId = row.getRowNum() + <span class="string">"_"</span> + cn;</span><br><span class="line">									saveImage(object, picId, excelParams, titleString, pictures,</span><br><span class="line">											params);</span><br><span class="line">								} <span class="keyword">else</span> {</span><br><span class="line">									<span class="keyword">try</span> {</span><br><span class="line">										saveFieldValues(params, object, cell, excelParams, titleString, row);</span><br><span class="line">									} <span class="keyword">catch</span> (ExcelImportException e) {</span><br><span class="line">										<span class="comment">// 如果需要去校验就忽略,这个错误,继续执行</span></span><br><span class="line">										<span class="keyword">if</span> (params.isNeedVerify() &amp;&amp; ExcelImportEnum.GET_VALUE_ERROR.equals(e.getType())) {</span><br><span class="line">											errorMsg.append(<span class="string">" "</span>).append(titleString).append(ExcelImportEnum.GET_VALUE_ERROR.getMsg());</span><br><span class="line">										}</span><br><span class="line">									}</span><br><span class="line">								}</span><br><span class="line">							}</span><br><span class="line">						}</span><br><span class="line"></span><br><span class="line">						<span class="keyword">if</span> (object <span class="keyword">instanceof</span> IExcelDataModel) {</span><br><span class="line">							((IExcelDataModel) object).setRowNum(row.getRowNum());</span><br><span class="line">						}</span><br><span class="line">						<span class="keyword">for</span> (ExcelCollectionParams param : excelCollection) {</span><br><span class="line">							addListContinues(object, param, row, titlemap, targetId, pictures, params, errorMsg);</span><br><span class="line">						}</span><br><span class="line">						<span class="keyword">if</span> (verifyingDataValiditys(object, row, params, isMap, errorMsg)) {</span><br><span class="line">							collection.add(object);</span><br><span class="line">						} <span class="keyword">else</span> {</span><br><span class="line">							failCollection.add(object);</span><br><span class="line">						}</span><br><span class="line">					} <span class="keyword">catch</span> (ExcelImportException e) {</span><br><span class="line">						LOGGER.error(<span class="string">"excel import error , row num:{},obj:{}"</span>, readRow, ReflectionToStringBuilder.toString(object));</span><br><span class="line">						<span class="keyword">if</span> (!e.getType().equals(ExcelImportEnum.VERIFY_ERROR)) {</span><br><span class="line">							<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(e.getType(), e);</span><br><span class="line">						}</span><br><span class="line">					} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">						LOGGER.error(<span class="string">"excel import error , row num:{},obj:{}"</span>, readRow, ReflectionToStringBuilder.toString(object));</span><br><span class="line">						<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">				readRow++;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> collection;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 校验数据合法性</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verifyingDataValiditys</span><span class="params">(Object object, Row row, ImportParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">										  <span class="keyword">boolean</span> isMap, StringBuilder fieldErrorMsg)</span> </span>{</span><br><span class="line">		<span class="keyword">boolean</span> isAdd = <span class="keyword">true</span>;</span><br><span class="line">		Cell cell = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (params.isNeedVerify()) {</span><br><span class="line">			String errorMsg = PoiValidationUtil.validation(object, params.getVerifyGroup());</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.isNotEmpty(errorMsg)) {</span><br><span class="line">				cell = row.createCell(row.getLastCellNum());</span><br><span class="line">				cell.setCellValue(errorMsg);</span><br><span class="line">				<span class="keyword">if</span> (object <span class="keyword">instanceof</span> IExcelModel) {</span><br><span class="line">					IExcelModel model = (IExcelModel) object;</span><br><span class="line">					model.setErrorMsg(errorMsg);</span><br><span class="line">				}</span><br><span class="line">				isAdd = <span class="keyword">false</span>;</span><br><span class="line">				verifyFail = <span class="keyword">true</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (params.getVerifyHandler() != <span class="keyword">null</span>) {</span><br><span class="line">			ExcelVerifyHandlerResult result = params.getVerifyHandler().verifyHandler(object);</span><br><span class="line">			<span class="keyword">if</span> (!result.isSuccess()) {</span><br><span class="line">				<span class="keyword">if</span> (cell == <span class="keyword">null</span>) {</span><br><span class="line">					cell = row.createCell(row.getLastCellNum());</span><br><span class="line">				}</span><br><span class="line">				cell.setCellValue((StringUtils.isNoneBlank(cell.getStringCellValue())</span><br><span class="line">						? cell.getStringCellValue() + <span class="string">","</span> : <span class="string">""</span>) + result.getMsg());</span><br><span class="line">				<span class="keyword">if</span> (object <span class="keyword">instanceof</span> IExcelModel) {</span><br><span class="line">					IExcelModel model = (IExcelModel) object;</span><br><span class="line">					model.setErrorMsg((StringUtils.isNoneBlank(model.getErrorMsg())</span><br><span class="line">							? model.getErrorMsg() + <span class="string">","</span> : <span class="string">""</span>) + result.getMsg());</span><br><span class="line">				}</span><br><span class="line">				isAdd = <span class="keyword">false</span>;</span><br><span class="line">				verifyFail = <span class="keyword">true</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> ((params.isNeedVerify() || params.getVerifyHandler() != <span class="keyword">null</span>) &amp;&amp; fieldErrorMsg.length() &gt; <span class="number">0</span>) {</span><br><span class="line">			<span class="keyword">if</span> (object <span class="keyword">instanceof</span> IExcelModel) {</span><br><span class="line">				IExcelModel model = (IExcelModel) object;</span><br><span class="line">				model.setErrorMsg((StringUtils.isNoneBlank(model.getErrorMsg())</span><br><span class="line">						? model.getErrorMsg() + <span class="string">","</span> : <span class="string">""</span>) + fieldErrorMsg.toString());</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (cell == <span class="keyword">null</span>) {</span><br><span class="line">				cell = row.createCell(row.getLastCellNum());</span><br><span class="line">			}</span><br><span class="line">			cell.setCellValue((StringUtils.isNoneBlank(cell.getStringCellValue())</span><br><span class="line">					? cell.getStringCellValue() + <span class="string">","</span> : <span class="string">""</span>) + fieldErrorMsg.toString());</span><br><span class="line">			isAdd = <span class="keyword">false</span>;</span><br><span class="line">			verifyFail = <span class="keyword">true</span>;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (cell != <span class="keyword">null</span>) {</span><br><span class="line">			cell.setCellStyle(errorCellStyle);</span><br><span class="line">			failRow.add(row);</span><br><span class="line">			<span class="keyword">if</span> (isMap) {</span><br><span class="line">				((Map) object).put(<span class="string">"excelErrorMsg"</span>, cell.getStringCellValue());</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			successRow.add(row);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> isAdd;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取表格字段列名对应信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Map&lt;Integer, String&gt; <span class="title">getTitleMap</span><span class="params">(Iterator&lt;Row&gt; rows, ImportParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">											 List&lt;ExcelCollectionParams&gt; excelCollection,</span></span></span><br><span class="line"><span class="function"><span class="params">											 Map&lt;String, ExcelImportEntity&gt; excelParams)</span> </span>{</span><br><span class="line">		Map&lt;Integer, String&gt; titlemap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">		Iterator&lt;Cell&gt; cellTitle;</span><br><span class="line">		String collectionName = <span class="keyword">null</span>;</span><br><span class="line">		ExcelCollectionParams collectionParams = <span class="keyword">null</span>;</span><br><span class="line">		Row row = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; params.getHeadRows(); j++) {</span><br><span class="line">			row = rows.next();</span><br><span class="line">			<span class="keyword">if</span> (row == <span class="keyword">null</span>) {</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			}</span><br><span class="line">			cellTitle = row.cellIterator();</span><br><span class="line">			<span class="keyword">while</span> (cellTitle.hasNext()) {</span><br><span class="line">				Cell cell = cellTitle.next();</span><br><span class="line">				String value = getKeyValue(cell);</span><br><span class="line">				value = value.replace(<span class="string">"\n"</span>, <span class="string">""</span>);</span><br><span class="line">				<span class="keyword">int</span> i = cell.getColumnIndex();</span><br><span class="line">				<span class="comment">//用以支持重名导入</span></span><br><span class="line">				<span class="keyword">if</span> (StringUtils.isNotEmpty(value)) {</span><br><span class="line">					<span class="keyword">if</span> (titlemap.containsKey(i)) {</span><br><span class="line">						collectionName = titlemap.get(i);</span><br><span class="line">						collectionParams = getCollectionParams(excelCollection, collectionName);</span><br><span class="line">						titlemap.put(i, collectionName + <span class="string">"_"</span> + value);</span><br><span class="line">					} <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.isNotEmpty(collectionName) &amp;&amp; collectionParams != <span class="keyword">null</span></span><br><span class="line">							&amp;&amp; collectionParams.getExcelParams()</span><br><span class="line">							.containsKey(collectionName + <span class="string">"_"</span> + value)) {</span><br><span class="line">						titlemap.put(i, collectionName + <span class="string">"_"</span> + value);</span><br><span class="line">					} <span class="keyword">else</span> {</span><br><span class="line">						collectionName = <span class="keyword">null</span>;</span><br><span class="line">						collectionParams = <span class="keyword">null</span>;</span><br><span class="line">					}</span><br><span class="line">					<span class="keyword">if</span> (StringUtils.isEmpty(collectionName)) {</span><br><span class="line">						titlemap.put(i, value);</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 处理指定列的情况</span></span><br><span class="line">		Set&lt;String&gt; keys = excelParams.keySet();</span><br><span class="line">		<span class="keyword">for</span> (String key : keys) {</span><br><span class="line">			<span class="keyword">if</span> (key.startsWith(<span class="string">"FIXED_"</span>)) {</span><br><span class="line">				String[] arr = key.split(<span class="string">"_"</span>);</span><br><span class="line">				titlemap.put(Integer.parseInt(arr[<span class="number">1</span>]), key);</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> titlemap;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取这个名称对应的集合信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> ExcelCollectionParams <span class="title">getCollectionParams</span><span class="params">(List&lt;ExcelCollectionParams&gt; excelCollection,</span></span></span><br><span class="line"><span class="function"><span class="params">													  String collectionName)</span> </span>{</span><br><span class="line">		<span class="keyword">for</span> (ExcelCollectionParams excelCollectionParams : excelCollection) {</span><br><span class="line">			<span class="keyword">if</span> (collectionName.equals(excelCollectionParams.getExcelName())) {</span><br><span class="line">				<span class="keyword">return</span> excelCollectionParams;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Excel 导入 field 字段类型 Integer,Long,Double,Date,String,Boolean</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ExcelImportResult <span class="title">importExcelByIss</span><span class="params">(InputStream inputstream, Class&lt;?&gt; pojoClass,</span></span></span><br><span class="line"><span class="function"><span class="params">											  ImportParams params, <span class="keyword">boolean</span> needMore)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">			LOGGER.debug(<span class="string">"Excel import start ,class is {}"</span>, pojoClass);</span><br><span class="line">		}</span><br><span class="line">		List&lt;T&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">		ExcelImportResult importResult;</span><br><span class="line">		<span class="keyword">try</span> {</span><br><span class="line">			<span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">			<span class="keyword">int</span> len;</span><br><span class="line">			<span class="keyword">while</span> ((len = inputstream.read(buffer)) &gt; -<span class="number">1</span>) {</span><br><span class="line">				baos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">			}</span><br><span class="line">			baos.flush();</span><br><span class="line"></span><br><span class="line">			InputStream userIs = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">			<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">				LOGGER.debug(<span class="string">"Excel clone success"</span>);</span><br><span class="line">			}</span><br><span class="line">			Workbook book = WorkbookFactory.create(userIs);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">boolean</span> isXSSFWorkbook = !(book <span class="keyword">instanceof</span> HSSFWorkbook);</span><br><span class="line">			<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">				LOGGER.debug(<span class="string">"Workbook create success"</span>);</span><br><span class="line">			}</span><br><span class="line">			importResult = <span class="keyword">new</span> ExcelImportResult();</span><br><span class="line">			createErrorCellStyle(book);</span><br><span class="line">			Map&lt;String, PictureData&gt; pictures;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = params.getStartSheetIndex(); i &lt; params.getStartSheetIndex()</span><br><span class="line">					+ params.getSheetNum(); i++) {</span><br><span class="line">				<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">					LOGGER.debug(<span class="string">" start to read excel by is ,startTime is {}"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">				}</span><br><span class="line">				<span class="keyword">if</span> (isXSSFWorkbook) {</span><br><span class="line">					pictures = PoiPublicUtil.getSheetPictrues07((XSSFSheet) book.getSheetAt(i),</span><br><span class="line">							(XSSFWorkbook) book);</span><br><span class="line">				} <span class="keyword">else</span> {</span><br><span class="line">					pictures = PoiPublicUtil.getSheetPictrues03((HSSFSheet) book.getSheetAt(i),</span><br><span class="line">							(HSSFWorkbook) book);</span><br><span class="line">				}</span><br><span class="line">				<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">					LOGGER.debug(<span class="string">" end to read excel by is ,endTime is {}"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">				}</span><br><span class="line">				result.addAll(importExcel(result, book.getSheetAt(i), pojoClass, params, pictures));</span><br><span class="line">				<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">					LOGGER.debug(<span class="string">" end to read excel list by sheet ,endTime is {}"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">				}</span><br><span class="line">				<span class="keyword">if</span> (params.isReadSingleCell()) {</span><br><span class="line">					readSingleCell(importResult, book.getSheetAt(i), params);</span><br><span class="line">					<span class="keyword">if</span> (LOGGER.isDebugEnabled()) {</span><br><span class="line">						LOGGER.debug(<span class="string">" read Key-Value ,endTime is {}"</span>, System.currentTimeMillis());</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (params.isNeedSave()) {</span><br><span class="line">				saveThisExcel(params, pojoClass, isXSSFWorkbook, book);</span><br><span class="line">			}</span><br><span class="line">			importResult.setList(result);</span><br><span class="line">			<span class="keyword">if</span> (needMore) {</span><br><span class="line">				InputStream successIs = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">				<span class="keyword">try</span> {</span><br><span class="line">					Workbook successBook = WorkbookFactory.create(successIs);</span><br><span class="line">					<span class="keyword">if</span> (params.isVerifyFileSplit()) {</span><br><span class="line">						importResult.setWorkbook(removeSuperfluousRows(successBook, failRow, params));</span><br><span class="line">						importResult.setFailWorkbook(removeSuperfluousRows(book, successRow, params));</span><br><span class="line">					} <span class="keyword">else</span> {</span><br><span class="line">						importResult.setWorkbook(book);</span><br><span class="line">					}</span><br><span class="line">					importResult.setFailList(failCollection);</span><br><span class="line">					importResult.setVerifyFail(verifyFail);</span><br><span class="line">				} <span class="keyword">finally</span> {</span><br><span class="line">					successIs.close();</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">finally</span> {</span><br><span class="line">			IOUtils.closeQuietly(baos);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> importResult;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Workbook <span class="title">removeSuperfluousRows</span><span class="params">(Workbook book, List&lt;Row&gt; rowList, ImportParams params)</span> </span>{</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = params.getStartSheetIndex(); i &lt; params.getStartSheetIndex()</span><br><span class="line">				+ params.getSheetNum(); i++) {</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = rowList.size() - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) {</span><br><span class="line">				<span class="keyword">if</span> (rowList.get(j).getRowNum() &lt; rowList.get(j).getSheet().getLastRowNum()) {</span><br><span class="line">					book.getSheetAt(i).shiftRows(rowList.get(j).getRowNum() + <span class="number">1</span>, rowList.get(j).getSheet().getLastRowNum(), -<span class="number">1</span>);</span><br><span class="line">				} <span class="keyword">else</span> <span class="keyword">if</span> (rowList.get(j).getRowNum() == rowList.get(j).getSheet().getLastRowNum()) {</span><br><span class="line">					book.getSheetAt(i).createRow(rowList.get(j).getRowNum() + <span class="number">1</span>);</span><br><span class="line">					book.getSheetAt(i).shiftRows(rowList.get(j).getRowNum() + <span class="number">1</span>, rowList.get(j).getSheet().getLastRowNum() + <span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> book;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按照键值对的方式取得Excel里面的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readSingleCell</span><span class="params">(ExcelImportResult result, Sheet sheet, ImportParams params)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (result.getMap() == <span class="keyword">null</span>) {</span><br><span class="line">			result.setMap(<span class="keyword">new</span> HashMap&lt;String, Object&gt;());</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.getTitleRows() + params.getHeadRows() + params.getStartRows(); i++) {</span><br><span class="line">			getSingleCellValueForRow(result, sheet.getRow(i), params);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = sheet.getLastRowNum() - params.getLastOfInvalidRow(); i &lt; sheet.getLastRowNum(); i++) {</span><br><span class="line">			getSingleCellValueForRow(result, sheet.getRow(i), params);</span><br><span class="line"></span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getSingleCellValueForRow</span><span class="params">(ExcelImportResult result, Row row, ImportParams params)</span> </span>{</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = row.getFirstCellNum(), le = row.getLastCellNum(); j &lt; le; j++) {</span><br><span class="line">			String text = PoiCellUtils.getCellValue(row.getCell(j));</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.isNoneBlank(text) &amp;&amp; text.endsWith(params.getKeyMark())) {</span><br><span class="line">				<span class="keyword">if</span> (result.getMap().containsKey(text)) {</span><br><span class="line">					<span class="keyword">if</span> (result.getMap().get(text) <span class="keyword">instanceof</span> String) {</span><br><span class="line">						List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">						list.add((String) result.getMap().get(text));</span><br><span class="line">						result.getMap().put(text, list);</span><br><span class="line">					}</span><br><span class="line">					((List) result.getMap().get(text)).add(PoiCellUtils.getCellValue(row.getCell(++j)));</span><br><span class="line">				} <span class="keyword">else</span> {</span><br><span class="line">					result.getMap().put(text, PoiCellUtils.getCellValue(row.getCell(++j)));</span><br><span class="line">				}</span><br><span class="line"></span><br><span class="line">			}</span><br><span class="line"></span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检查是不是合法的模板</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkIsValidTemplate</span><span class="params">(Map&lt;Integer, String&gt; titlemap,</span></span></span><br><span class="line"><span class="function"><span class="params">									  Map&lt;String, ExcelImportEntity&gt; excelParams,</span></span></span><br><span class="line"><span class="function"><span class="params">									  ImportParams params,</span></span></span><br><span class="line"><span class="function"><span class="params">									  List&lt;ExcelCollectionParams&gt; excelCollection)</span> </span>{</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (params.getImportFields() != <span class="keyword">null</span>) {</span><br><span class="line">			<span class="comment">// 同时校验列顺序</span></span><br><span class="line">			<span class="keyword">if</span> (params.isNeedCheckOrder()) {</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (params.getImportFields().length != titlemap.size()) {</span><br><span class="line">					LOGGER.error(<span class="string">"excel列顺序不一致"</span>);</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.IS_NOT_A_VALID_TEMPLATE);</span><br><span class="line">				}</span><br><span class="line">				<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">for</span> (String title : titlemap.values()) {</span><br><span class="line">					<span class="keyword">if</span> (!StringUtils.equals(title, params.getImportFields()[i++])) {</span><br><span class="line">						LOGGER.error(<span class="string">"excel列顺序不一致"</span>);</span><br><span class="line">						<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.IS_NOT_A_VALID_TEMPLATE);</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, le = params.getImportFields().length; i &lt; le; i++) {</span><br><span class="line">					<span class="keyword">if</span> (!titlemap.containsValue(params.getImportFields()[i])) {</span><br><span class="line">						<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.IS_NOT_A_VALID_TEMPLATE);</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			Collection&lt;ExcelImportEntity&gt; collection = excelParams.values();</span><br><span class="line">			<span class="keyword">for</span> (ExcelImportEntity excelImportEntity : collection) {</span><br><span class="line">				<span class="keyword">if</span> (excelImportEntity.isImportField()</span><br><span class="line">						&amp;&amp; !titlemap.containsValue(excelImportEntity.getName())) {</span><br><span class="line">					LOGGER.error(excelImportEntity.getName() + <span class="string">"必须有,但是没找到"</span>);</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.IS_NOT_A_VALID_TEMPLATE);</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, le = excelCollection.size(); i &lt; le; i++) {</span><br><span class="line">				ExcelCollectionParams collectionparams = excelCollection.get(i);</span><br><span class="line">				collection = collectionparams.getExcelParams().values();</span><br><span class="line">				<span class="keyword">for</span> (ExcelImportEntity excelImportEntity : collection) {</span><br><span class="line">					<span class="keyword">if</span> (excelImportEntity.isImportField() &amp;&amp; !titlemap.containsValue(</span><br><span class="line">							collectionparams.getExcelName() + <span class="string">"_"</span> + excelImportEntity.getName())) {</span><br><span class="line">						<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.IS_NOT_A_VALID_TEMPLATE);</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存字段值(获取值,校验值,追加错误信息)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveFieldValues</span><span class="params">(ImportParams params, Object object, Cell cell,</span></span></span><br><span class="line"><span class="function"><span class="params">								Map&lt;String, ExcelImportEntity&gt; excelParams, String titleString,</span></span></span><br><span class="line"><span class="function"><span class="params">								Row row)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		Object value = getValues(params.getDataHandler(), object, cell, excelParams,</span><br><span class="line">				titleString, params.getDictHandler());</span><br><span class="line">		<span class="keyword">if</span> (object <span class="keyword">instanceof</span> Map) {</span><br><span class="line">			<span class="keyword">if</span> (params.getDataHandler() != <span class="keyword">null</span>) {</span><br><span class="line">				params.getDataHandler().setMapValue((Map) object, titleString, value);</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				((Map) object).put(titleString, value);</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			setValues(excelParams.get(titleString), object, value);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getValues</span><span class="params">(IExcelDataHandler&lt;?&gt; dataHandler, Object object, Object cell,</span></span></span><br><span class="line"><span class="function"><span class="params">							Map&lt;String, ExcelImportEntity&gt; excelParams,</span></span></span><br><span class="line"><span class="function"><span class="params">							String titleString, IExcelDictHandler dictHandler)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">		ExcelImportEntity entity = excelParams.get(titleString);</span><br><span class="line">		String classFullName = <span class="string">"class java.lang.Object"</span>;</span><br><span class="line">		Class clazz = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (!(object <span class="keyword">instanceof</span> Map)) {</span><br><span class="line">			Method setMethod = entity.getMethods() != <span class="keyword">null</span> &amp;&amp; entity.getMethods().size() &gt; <span class="number">0</span></span><br><span class="line">					? entity.getMethods().get(entity.getMethods().size() - <span class="number">1</span>) : entity.getMethod();</span><br><span class="line">			Type[] ts = setMethod.getGenericParameterTypes();</span><br><span class="line">			classFullName = ts[<span class="number">0</span>].toString();</span><br><span class="line">			clazz = (Class) ts[<span class="number">0</span>];</span><br><span class="line">		}</span><br><span class="line">		Object result = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (cell <span class="keyword">instanceof</span> Cell) {</span><br><span class="line">			result = getCellValues(classFullName, (Cell) cell, entity);</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			result = cell;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (entity != <span class="keyword">null</span>) {</span><br><span class="line">			result = handlerSuffix(entity.getSuffix(), result);</span><br><span class="line">			result = replaceValue(entity.getReplace(), result);</span><br><span class="line">			result = replaceValue(entity.getReplace(), result);</span><br><span class="line">			<span class="keyword">if</span> (dictHandler != <span class="keyword">null</span> &amp;&amp; StringUtils.isNoneBlank(entity.getDict())) {</span><br><span class="line">				result = dictHandler.toValue(entity.getDict(), object, entity.getName(), result);</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		result = handlerValue(dataHandler, object, result, titleString);</span><br><span class="line">		<span class="keyword">return</span> getValueByType(classFullName, result, entity, clazz);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">getValueByType</span><span class="params">(String classFullName, Object result, ExcelImportEntity entity, Class clazz)</span> </span>{</span><br><span class="line">		<span class="keyword">try</span> {</span><br><span class="line">			<span class="comment">//过滤空和空字符串,如果基本类型null会在上层抛出,这里就不处理了</span></span><br><span class="line">			<span class="keyword">if</span> (result == <span class="keyword">null</span> || StringUtils.isBlank(result.toString())) {</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.util.Date"</span>.equals(classFullName) &amp;&amp; result <span class="keyword">instanceof</span> String) {</span><br><span class="line">				<span class="keyword">return</span> DateUtils.parseDate(result.toString(), entity.getFormat());</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.lang.Boolean"</span>.equals(classFullName) || <span class="string">"boolean"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="keyword">return</span> Boolean.valueOf(String.valueOf(result));</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.lang.Double"</span>.equals(classFullName) || <span class="string">"double"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="keyword">return</span> Double.valueOf(String.valueOf(result));</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.lang.Long"</span>.equals(classFullName) || <span class="string">"long"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="keyword">try</span> {</span><br><span class="line">					<span class="keyword">return</span> Long.valueOf(String.valueOf(result));</span><br><span class="line">				} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">					<span class="comment">//格式错误的时候,就用double,然后获取Int值</span></span><br><span class="line">					<span class="keyword">return</span> Double.valueOf(String.valueOf(result)).longValue();</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.lang.Float"</span>.equals(classFullName) || <span class="string">"float"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="keyword">return</span> Float.valueOf(String.valueOf(result));</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.lang.Integer"</span>.equals(classFullName) || <span class="string">"int"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="keyword">try</span> {</span><br><span class="line">					<span class="keyword">return</span> Integer.valueOf(String.valueOf(result));</span><br><span class="line">				} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">					<span class="comment">//格式错误的时候,就用double,然后获取Int值</span></span><br><span class="line">					<span class="keyword">return</span> Double.valueOf(String.valueOf(result)).intValue();</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.math.BigDecimal"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(String.valueOf(result));</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (<span class="string">"class java.lang.String"</span>.equals(classFullName)) {</span><br><span class="line">				<span class="comment">//针对String 类型,但是Excel获取的数据却不是String,比如Double类型,防止科学计数法</span></span><br><span class="line">				<span class="keyword">if</span> (result <span class="keyword">instanceof</span> String) {</span><br><span class="line">					<span class="keyword">return</span> result;</span><br><span class="line">				}</span><br><span class="line">				<span class="comment">// double类型防止科学计数法</span></span><br><span class="line">				<span class="keyword">if</span> (result <span class="keyword">instanceof</span> Double) {</span><br><span class="line">					<span class="keyword">return</span> PoiPublicUtil.doubleToString((Double) result);</span><br><span class="line">				}</span><br><span class="line">				<span class="keyword">return</span> String.valueOf(result);</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> (clazz != <span class="keyword">null</span> &amp;&amp; clazz.isEnum()) {</span><br><span class="line">				<span class="keyword">if</span> (StringUtils.isNotEmpty(entity.getEnumImportMethod())) {</span><br><span class="line">					<span class="keyword">return</span> PoiReflectorUtil.fromCache(clazz).execEnumStaticMethod(entity.getEnumImportMethod(), result);</span><br><span class="line">				} <span class="keyword">else</span> {</span><br><span class="line">					<span class="keyword">return</span> Enum.valueOf(clazz, result.toString());</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">			LOGGER.error(e.getMessage(), e);</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.GET_VALUE_ERROR);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">handlerValue</span><span class="params">(IExcelDataHandler dataHandler, Object object, Object result,</span></span></span><br><span class="line"><span class="function"><span class="params">								String titleString)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (dataHandler == <span class="keyword">null</span> || dataHandler.getNeedHandlerFields() == <span class="keyword">null</span></span><br><span class="line">				|| dataHandler.getNeedHandlerFields().length == <span class="number">0</span>) {</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (handlerList == <span class="keyword">null</span>) {</span><br><span class="line">			handlerList = Arrays.asList(dataHandler.getNeedHandlerFields());</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">if</span> (handlerList.contains(titleString)) {</span><br><span class="line">			<span class="keyword">return</span> dataHandler.importHandler(object, titleString, result);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">handlerSuffix</span><span class="params">(String suffix, Object result)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isNotEmpty(suffix) &amp;&amp; result != <span class="keyword">null</span></span><br><span class="line">				&amp;&amp; result.toString().endsWith(suffix)) {</span><br><span class="line">			String temp = result.toString();</span><br><span class="line">			<span class="keyword">return</span> temp.substring(<span class="number">0</span>, temp.length() - suffix.length());</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">replaceValue</span><span class="params">(String[] replace, Object result)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (replace != <span class="keyword">null</span> &amp;&amp; replace.length &gt; <span class="number">0</span>) {</span><br><span class="line">			String temp = String.valueOf(result);</span><br><span class="line">			String[] tempArr;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; replace.length; i++) {</span><br><span class="line">				tempArr = replace[i].split(<span class="string">"_"</span>);</span><br><span class="line">				<span class="keyword">if</span> (temp.equals(tempArr[<span class="number">0</span>])) {</span><br><span class="line">					<span class="keyword">return</span> tempArr[<span class="number">1</span>];</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">getCellValues</span><span class="params">(String classFullName, Cell cell, ExcelImportEntity entity)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (cell == <span class="keyword">null</span>) {</span><br><span class="line">			<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">		}</span><br><span class="line">		Object result = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="string">"class java.util.Date"</span>.equals(classFullName)</span><br><span class="line">				|| <span class="string">"class java.sql.Date"</span>.equals(classFullName)</span><br><span class="line">				|| (<span class="string">"class java.sql.Time"</span>).equals(classFullName)</span><br><span class="line">				|| (<span class="string">"class java.time.Instant"</span>).equals(classFullName)</span><br><span class="line">				|| (<span class="string">"class java.time.LocalDate"</span>).equals(classFullName)</span><br><span class="line">				|| (<span class="string">"class java.time.LocalDateTime"</span>).equals(classFullName)</span><br><span class="line">				|| (<span class="string">"class java.sql.Timestamp"</span>).equals(classFullName)) {</span><br><span class="line">			<span class="comment">//FIX: 单元格yyyyMMdd数字时候使用 cell.getDateCellValue() 解析出的日期错误</span></span><br><span class="line">			<span class="keyword">if</span> (CellType.NUMERIC == cell.getCellTypeEnum() &amp;&amp; DateUtil.isCellDateFormatted(cell)) {</span><br><span class="line">				result = DateUtil.getJavaDate(cell.getNumericCellValue());</span><br><span class="line">			} <span class="keyword">else</span> {</span><br><span class="line">				String val = <span class="string">""</span>;</span><br><span class="line">				<span class="keyword">try</span> {</span><br><span class="line">					val = cell.getStringCellValue();</span><br><span class="line">				} <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">				}</span><br><span class="line"></span><br><span class="line">				result = getDateData(entity, val);</span><br><span class="line">				<span class="keyword">if</span> (result == <span class="keyword">null</span>) {</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">if</span> ((<span class="string">"class java.time.Instant"</span>).equals(classFullName)) {</span><br><span class="line">				result = ((Date) result).toInstant();</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.time.LocalDate"</span>).equals(classFullName)) {</span><br><span class="line">				result = ((Date) result).toInstant().atZone(ZoneId.systemDefault()).toLocalDate();</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.time.LocalDateTime"</span>).equals(classFullName)) {</span><br><span class="line">				result = ((Date) result).toInstant().atZone(ZoneId.systemDefault()).toLocalDateTime();</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.time.OffsetDateTime"</span>).equals(classFullName)) {</span><br><span class="line">				result = ((Date) result).toInstant().atZone(ZoneId.systemDefault()).toOffsetDateTime();</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.time.ZonedDateTime"</span>).equals(classFullName)) {</span><br><span class="line">				result = ((Date) result).toInstant().atZone(ZoneId.systemDefault());</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.sql.Date"</span>).equals(classFullName)) {</span><br><span class="line">				result = <span class="keyword">new</span> java.sql.Date(((Date) result).getTime());</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.sql.Time"</span>).equals(classFullName)) {</span><br><span class="line">				result = <span class="keyword">new</span> Time(((Date) result).getTime());</span><br><span class="line">			} <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="string">"class java.sql.Timestamp"</span>).equals(classFullName)) {</span><br><span class="line">				result = <span class="keyword">new</span> Timestamp(((Date) result).getTime());</span><br><span class="line">			}</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="keyword">switch</span> (cell.getCellTypeEnum()) {</span><br><span class="line">				<span class="keyword">case</span> STRING:</span><br><span class="line">					result = cell.getRichStringCellValue() == <span class="keyword">null</span> ? <span class="string">""</span></span><br><span class="line">							: cell.getRichStringCellValue().getString();</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> NUMERIC:</span><br><span class="line">					<span class="keyword">if</span> (DateUtil.isCellDateFormatted(cell)) {</span><br><span class="line">						<span class="keyword">if</span> (<span class="string">"class java.lang.String"</span>.equals(classFullName)) {</span><br><span class="line">							result = formateDate(entity, cell.getDateCellValue());</span><br><span class="line">						}</span><br><span class="line">					} <span class="keyword">else</span> {</span><br><span class="line">						result = readNumericCell(cell);</span><br><span class="line">					}</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> BOOLEAN:</span><br><span class="line">					result = Boolean.toString(cell.getBooleanCellValue());</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> BLANK:</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> ERROR:</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> FORMULA:</span><br><span class="line">					<span class="keyword">try</span> {</span><br><span class="line">						result = readNumericCell(cell);</span><br><span class="line">					} <span class="keyword">catch</span> (Exception e1) {</span><br><span class="line">						<span class="keyword">try</span> {</span><br><span class="line">							result = cell.getRichStringCellValue() == <span class="keyword">null</span> ? <span class="string">""</span></span><br><span class="line">									: cell.getRichStringCellValue().getString();</span><br><span class="line">						} <span class="keyword">catch</span> (Exception e2) {</span><br><span class="line">							<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"获取公式类型的单元格失败"</span>, e2);</span><br><span class="line">						}</span><br><span class="line">					}</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">default</span>:</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">readNumericCell</span><span class="params">(Cell cell)</span> </span>{</span><br><span class="line">		Object result = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">double</span> value = cell.getNumericCellValue();</span><br><span class="line">		<span class="keyword">if</span> (((<span class="keyword">int</span>) value) == value) {</span><br><span class="line">			result = (<span class="keyword">int</span>) value;</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			result = value;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">formateDate</span><span class="params">(ExcelImportEntity entity, Date value)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isNotEmpty(entity.getFormat()) &amp;&amp; value != <span class="keyword">null</span>) {</span><br><span class="line">			SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(entity.getFormat());</span><br><span class="line">			<span class="keyword">return</span> format.format(value);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Date <span class="title">getDateData</span><span class="params">(ExcelImportEntity entity, String value)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isNotEmpty(entity.getFormat()) &amp;&amp; StringUtils.isNotEmpty(value)) {</span><br><span class="line">			SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(entity.getFormat());</span><br><span class="line">			<span class="keyword">try</span> {</span><br><span class="line">				<span class="keyword">return</span> format.parse(value);</span><br><span class="line">			} <span class="keyword">catch</span> (ParseException e) {</span><br><span class="line">				<span class="keyword">try</span> {</span><br><span class="line">					<span class="keyword">return</span> DateUtil.getJavaDate(Double.parseDouble(value));</span><br><span class="line">				} <span class="keyword">catch</span> (NumberFormatException ex) {</span><br><span class="line">					LOGGER.error(<span class="string">"时间格式化失败,格式化:{},值:{}"</span>, entity.getFormat(), value);</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> ExcelImportException(ExcelImportEnum.GET_VALUE_ERROR);</span><br><span class="line">				}</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> picId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> excelParams</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> titleString</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pictures</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveImage</span><span class="params">(Object object, String picId, Map&lt;String, ExcelImportEntity&gt; excelParams,</span></span></span><br><span class="line"><span class="function"><span class="params">						   String titleString, Map&lt;String, PictureData&gt; pictures,</span></span></span><br><span class="line"><span class="function"><span class="params">						   ImportParams params)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">		<span class="keyword">if</span> (pictures == <span class="keyword">null</span>) {</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		}</span><br><span class="line">		PictureData image = pictures.get(picId);</span><br><span class="line">		<span class="keyword">if</span> (image == <span class="keyword">null</span>) {</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">byte</span>[] data = image.getData();</span><br><span class="line">		String fileName = <span class="string">"pic"</span> + Math.round(Math.random() * <span class="number">100000000000L</span>);</span><br><span class="line">		fileName += <span class="string">"."</span> + PoiPublicUtil.getFileExtendName(data);</span><br><span class="line">		<span class="keyword">if</span> (excelParams.get(titleString).getSaveType() == <span class="number">1</span>) {</span><br><span class="line">			String path = getSaveUrl(excelParams.get(titleString), object);</span><br><span class="line">			File savefile = <span class="keyword">new</span> File(path);</span><br><span class="line">			<span class="keyword">if</span> (!savefile.exists()) {</span><br><span class="line">				savefile.mkdirs();</span><br><span class="line">			}</span><br><span class="line">			savefile = <span class="keyword">new</span> File(path + File.separator + fileName);</span><br><span class="line">			FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(savefile);</span><br><span class="line">			<span class="keyword">try</span> {</span><br><span class="line">				fos.write(data);</span><br><span class="line">			} <span class="keyword">finally</span> {</span><br><span class="line">				IOUtils.closeQuietly(fos);</span><br><span class="line">			}</span><br><span class="line">			setValues(excelParams.get(titleString), object,</span><br><span class="line">					getSaveUrl(excelParams.get(titleString), object) + File.separator + fileName);</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			setValues(excelParams.get(titleString), object, data);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createErrorCellStyle</span><span class="params">(Workbook workbook)</span> </span>{</span><br><span class="line">		errorCellStyle = workbook.createCellStyle();</span><br><span class="line">		Font font = workbook.createFont();</span><br><span class="line">		font.setColor(Font.COLOR_RED);</span><br><span class="line">		errorCellStyle.setFont(font);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>调用：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation("导入Excel模板，修改更新数据")</span></span><br><span class="line">    <span class="meta">@PostMapping("/importExcelTemplate")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">importMemberList</span><span class="params">(<span class="meta">@RequestPart("file")</span> MultipartFile file)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            ImportParams params = <span class="keyword">new</span> ImportParams();</span><br><span class="line">            params.setTitleRows(<span class="number">1</span>);</span><br><span class="line">            params.setHeadRows(<span class="number">1</span>);</span><br><span class="line">            List&lt;TemplateExcelExport&gt; list = ExcelUtils.importExcelRewrite(file.getInputStream(), TemplateExcelExport.class,params);</span><br><span class="line">            List&lt;AlarmSiteInfo&gt; alarmSiteInfos = BeanMapper.INSTANCE.toAlarmSiteInfoList(list);</span><br><span class="line">            <span class="keyword">this</span>.alarmSiteService.updateBatchById(alarmSiteInfos);</span><br><span class="line">            <span class="keyword">return</span> R.ok();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> R.failed(<span class="string">"导入失败！"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

    </div>
   <div>
        
            <div style="text-align:left;font-size:14px;">
    <p style="text-align:center;color: #ccc;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</p>
            </div>
        
    </div>

   
    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/2SZHQ52.html" rel="bookmark">如何优雅地记录操作日志</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/1J88EXM.html" rel="bookmark">如何设计一个秒杀系统</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/3N8921N.html" rel="bookmark">彻底讲透Elasticsearch</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/3DS4M6Q.html" rel="bookmark">Kafka面试连环炮-上</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/posts/1F4JVMQ.html" rel="bookmark">一文搞懂redis</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wexinPay.jpeg" alt="meadee 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/zhifubaoPay.jpeg" alt="meadee 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>meadee
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://blog.xuemingde.com/posts/HAXCJE.html" title="easypoi导入Excel表格报错">https://blog.xuemingde.com/posts/HAXCJE.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C</a>
              <a href="/tags/sql/" rel="tag"><i class="fa fa-tag"></i> sql</a>
              <a href="/tags/cache/" rel="tag"><i class="fa fa-tag"></i> cache</a>
              <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/1VWTGBN.html" rel="prev" title="README">
      <i class="fa fa-chevron-left"></i> README
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/39AKQ95.html" rel="next" title="Seata-server启动闪退问题">
      Seata-server启动闪退问题 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    

  </article>
  
  
  



           </div>
          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

          
<script src="https://readmore.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container-1',
        blogId: '29491-1649429697615-963',
        name: '不闻一时',
        qrcode: 'https://xuemingde.com/pages/image/2022/05/31093822.png',
        keyword: 'meadel',
    });
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="meadee" src="/images/touxiang.jpeg">
  <p class="site-author-name" itemprop="name">meadee</p>
  <div class="site-description" itemprop="description">沉默，有时候是一种无声的反抗</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">181</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vdXNlci80MDE5NDcwMjQ0MjU4NTUyL3Bvc3Rz" title="掘金 → https://juejin.cn/user/4019470244258552/posts"><i class="fa fa-share-alt fa-fw"></i>掘金</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbWVhZGVyL25vdGUvYm9hcmQ/ZnVsbHNjcmVlbj0x" title="issues → https://gitee.com/meader/note/board?fullscreen=1"><i class="fab fa-github-alt fa-fw"></i>issues</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3h1ZV9taW5k" title="CSDN → https://blog.csdn.net/xue_mind"><i class="fa fa-th-list fa-fw"></i>CSDN</span>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLw==" title="https://tech.meituan.com/">美团团队</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLw==" title="http://www.ruanyifeng.com/blog/">阮一峰网络日志</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtc2V0L2FsbC8=" title="https://leetcode.cn/problemset/all/">LeetCode</span>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  © 2016 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-star"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">meadee</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 ≈</span>
    <span title="站点阅读时长">15:39</span>
</div>

<div>
<span id="timeDate2">载入天数...</span><span id="times2"></span>
<script>
    var now2 = new Date(); 
    function createtime3() { 
        var grt= new Date("03/28/1992 00:00:00");//在此处修改你的建站时间
        now2.setTime(now2.getTime()+250); 
        var days = (now2 - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        var hours = (now2 - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now2 - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        var mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        var seconds = (now2 - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        var snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate2").innerHTML = "走过了 "+dnum+" 个日夜，从嘤嘤坠地，到步履蹒跚，从年少无知，到心事重重，岁月啊，总让人平添太多无奈"; 
    } 
setInterval("createtime3()",250);
</script>
</div>
  <div class="powered-by">  </div>

        
<div class="busuanzi-count">
  <script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zindex="-1" src="../js/canvas-ribbon.js"></script>
  <script src="../js/anime.min.js"></script>
  <script src="../js/pjax.min.js"></script>
  <script src="../js/jquery.min.js"></script>
  <script src="../js/jquery.fancybox.min.js"></script>
  <script src="../js/medium-zoom.min.js"></script>
  <script src="../js/lozad.min.js"></script>
  <script src="../js/pangu.min.js"></script>
  <script src="../js/velocity.min.js"></script>
  <script src="../js/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>


  <script defer="" src="../js/three.min.js"></script>
    <script defer="" src="../js/three-waves.min.js"></script>
    <script defer="" src="../js/canvas_lines.min.js"></script>
    <script defer="" src="../js/canvas_sphere.min.js"></script>


  
  <script data-pjax="">
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>



  <script data-pjax="">
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 34163,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>









<script data-pjax="">
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script data-pjax="">
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('../js/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

<link rel="stylesheet" href="../js/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('../js/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '425b9527efc45ef76990',
      clientSecret: '4a956b1310ea8ab928ed1d278e85c98988ec51aa',
      repo        : 'blog',
      owner       : 'wuwenyishi',
      admin       : ['wuwenyishi'],
      id          : '9629a2a1e8249d60856d36fa4e5a0af9',
        language: 'zh-CN',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
  <link rel="stylesheet" href="/dist/APlayer.min.css">
  <div id="aplayer"></div>
  <script type="text/javascript" src="/dist/APlayer.min.js"></script>
  <script type="text/javascript" src="/dist/music.js"></script>


<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>